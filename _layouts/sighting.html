---
layout: default
---

{% assign poster_url = page.media-key | prepend: site.media_base_url | append: '_Thumbnail.jpg' %}
{% assign movie_url = page.media-key | prepend: site.media_base_url | append: '.mp4' %}
{% assign principle_url = page.principle | slugify | prepend: '/principles/' %}

<main class="sighting">
  <div class="content">
    <a class="principle" href="{{ principle_url }}">{{ page.principle }}</a>
    <video controls
       src="{{ movie_url }}"
       poster="{{ poster_url }}">
      <a href="{{ movie_url }}">
        <img src="{{ poster_url }}">
      </a>
    </video>
    <h1>{{ page.title }}</h1>
    {% if page.summary %}
      <div class="summary">{{ page.summary }}</div>
    {% endif %}
    {{ content }}
  </div>

  <aside>
    <dl>
      <dt>Principle</dt>
      <dd><a href="{{ principle_url }}">{{ page.principle }}</a></dd>
      <dt>Teaching Team</dt>
      <dd>{{ page.teaching-team }}</dd>
      <dt>Class</dt>
      <dd>{{ page.course-number }} {{ page.course-title }}</dd>
    </dl>
  </aside>
</main>

{% assign related = '' | split: '' %}
{% assign courseCount = 0 %}
{% assign principleCount = 0 %}
{% for sighting in site.sightings %}
  {% if sighting.path == page.path %}{% continue %}{% endif %}
  {% if sighting.course-number == page.course-number %}{% assign courseCount = courseCount | plus: 1 %}{% endif %}
  {% if sighting.principle == page.principle %}{% assign principleCount = principleCount | plus: 1 %}{% endif %}
  {% assign related = related | push: sighting %}
{% endfor %}

{% if courseCount > 0 or principleCount > 0 %}
{% assign initial-selection = 'principle' %}
{% if principleCount == 0 %}{% assign initial-selection = 'course' %}{% endif %}
  <section class="related-content same-{{ initial-selection }}">
    <h2>Related Content</h2>
    <div style="padding-left: 15px;">
      {% if principleCount > 0 %}
        <button class="principle-button" onClick="showRelated('principle')">by principle</button>
      {% endif %}
      {% if courseCount > 0 %}
        <button class="course-button" onClick="showRelated('course')">by course</button>
      {% endif %}
    </div>
  <div class="sightings random grid">
    {% for sighting in related %}
      {% assign visibleClass = '' %}
      {% if sighting.principle != page.principle %}
        {% assign visibleClass = visibleClass | append: ' different-principle' %}
      {% endif %}
      {% if sighting.course-number != page.course-number %}
        {% assign visibleClass = visibleClass | append: ' different-course' %}
      {% endif %}
      <a class="sighting card {{ visibleClass }}" href={{ sighting.url }}>
        <div class="principle">{{ sighting.principle }}</div>
        <img src="{{ sighting.media-key | prepend: site.media_base_url | append: '_Thumbnail.jpg' }}"/>
        <h1>{{ sighting.title }}</h1>
        {% if sighting.summary %}
          <div class="quoted summary">{{ sighting.summary }}</div>
        {% else %}
          <div class="summary">Summary TBD</div>
        {% endif %}
      </a>
    {% endfor %}
    </div>
  </section>
{% endif %}

<script>
  function showRelated(sel) {
    const elt = document.querySelector('.related-content');
    elt.className = elt.className.replace(/\bsame-\w+/, ' same-' + sel);
  }
</script>
